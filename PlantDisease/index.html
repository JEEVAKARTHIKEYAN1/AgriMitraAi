<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Plant Disease Detector - ViT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --green:#059669;
      --green-soft:#dcfce7;
      --border:#e5e7eb;
      --text-muted:#6b7280;
    }
    body {
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:linear-gradient(135deg,#ecfdf5,#d1fae5);
    }
    .card {
      background:white;
      width:100%;
      max-width:480px;
      padding:24px 24px 30px;
      border-radius:16px;
      box-shadow:0 15px 35px rgba(15,23,42,0.15);
      border:1px solid rgba(148,163,184,0.2);
    }
    h1 {
      margin:0 0 4px;
      font-size:24px;
      text-align:center;
    }
    .subtitle {
      margin:0 0 16px;
      text-align:center;
      color:var(--text-muted);
      font-size:13px;
    }
    .preview {
      width:260px;
      height:260px;
      border-radius:18px;
      border:1px dashed var(--border);
      margin:0 auto 14px;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      background:#f9fafb;
    }
    #previewImg {
      max-width:100%;
      max-height:100%;
      display:none;
    }
    .placeholder {
      text-align:center;
      color:var(--text-muted);
      font-size:13px;
    }
    .placeholder span {
      font-size:30px;
      display:block;
      margin-bottom:6px;
    }
    .btn-row {
      display:flex;
      gap:10px;
      margin-top:10px;
    }
    button, label.upload-label {
      flex:1;
      border-radius:999px;
      padding:10px 14px;
      border:none;
      cursor:pointer;
      font-weight:600;
      font-size:14px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      transition:transform 0.06s ease, box-shadow 0.06s ease, background 0.15s ease;
    }
    label.upload-label {
      border:1px solid var(--border);
      background:white;
      color:#111827;
    }
    button.predict-btn {
      background:linear-gradient(90deg,#16a34a,#22c55e);
      color:white;
      box-shadow:0 10px 20px rgba(34,197,94,0.35);
    }
    button:disabled {
      opacity:.55;
      cursor:not-allowed;
      box-shadow:none;
      transform:none;
    }
    button:hover:not(:disabled),
    label.upload-label:hover {
      transform:translateY(-1px);
      box-shadow:0 6px 14px rgba(15,23,42,0.18);
    }
    #fileInput { display:none; }

    .status {
      margin-top:16px;
      padding:12px 12px;
      border-radius:12px;
      font-size:13px;
      border:1px solid var(--border);
      background:#f9fafb;
    }
    .status strong {
      font-size:14px;
    }
    .status.ok {
      border-color:#bbf7d0;
      background:var(--green-soft);
      color:#047857;
    }
    .status.error {
      border-color:#fecaca;
      background:#fef2f2;
      color:#b91c1c;
    }
    .prediction {
      margin-top:10px;
      padding:12px;
      border-radius:12px;
      background:#ecfdf5;
      border:1px solid #bbf7d0;
      font-size:14px;
    }
    .prediction span.label {
      font-weight:700;
      color:#065f46;
    }
    .loader {
      border:3px solid #d1fae5;
      border-top:3px solid var(--green);
      border-radius:50%;
      width:18px;
      height:18px;
      animation:spin 0.8s linear infinite;
    }
    @keyframes spin {
      0% { transform:rotate(0deg); }
      100% { transform:rotate(360deg); }
    }
  </style>
</head>
<body>

<div class="card">
  <h1>Plant Disease Detector</h1>
  <p class="subtitle">ViT-based classifier ‚Äì upload a leaf image to get prediction</p>

  <div class="preview">
    <img id="previewImg" alt="Preview">
    <div id="previewPlaceholder" class="placeholder">
      <span>üåø</span>
      Choose a plant leaf image<br>to start prediction
    </div>
  </div>

  <div class="btn-row">
    <label for="fileInput" class="upload-label">
      üìÅ Choose Image
    </label>
    <input type="file" id="fileInput" accept="image/*">
    <button id="predictBtn" class="predict-btn" disabled>
      üîç Predict
    </button>
  </div>

  <div id="statusBox" class="status" style="display:none;"></div>
  <div id="predictionBox" class="prediction" style="display:none;">
    <div><span class="label">Prediction:</span> <span id="predictionText">-</span></div>
  </div>
</div>

<script>
  const fileInput = document.getElementById('fileInput');
  const previewImg = document.getElementById('previewImg');
  const previewPlaceholder = document.getElementById('previewPlaceholder');
  const predictBtn = document.getElementById('predictBtn');
  const statusBox = document.getElementById('statusBox');
  const predictionBox = document.getElementById('predictionBox');
  const predictionText = document.getElementById('predictionText');

  let selectedFile = null;

  fileInput.addEventListener('change', function () {
    const file = this.files[0];
    if (!file) {
      selectedFile = null;
      previewImg.style.display = 'none';
      previewPlaceholder.style.display = 'block';
      predictBtn.disabled = true;
      return;
    }
    selectedFile = file;

    const reader = new FileReader();
    reader.onload = e => {
      previewImg.src = e.target.result;
      previewImg.style.display = 'block';
      previewPlaceholder.style.display = 'none';
    };
    reader.readAsDataURL(file);

    predictBtn.disabled = false;
    statusBox.style.display = 'none';
    predictionBox.style.display = 'none';
  });

  function setStatus(message, type) {
    statusBox.textContent = message;
    statusBox.className = 'status ' + (type || '');
    statusBox.style.display = 'block';
  }

  predictBtn.addEventListener('click', async function () {
    if (!selectedFile) {
      setStatus('Please choose an image first.', 'error');
      return;
    }

    const backendUrl = 'http://localhost:5001/predict'; // must match Flask port

    const formData = new FormData();
    formData.append('file', selectedFile);

    predictBtn.disabled = true;
    const oldHtml = predictBtn.innerHTML;
    predictBtn.innerHTML = '<div class="loader"></div> Analyzing...';
    setStatus('Sending image to model API...', '');

    try {
      const res = await fetch(backendUrl, {
        method: 'POST',
        body: formData
      });

      const data = await res.json();

      if (!res.ok) {
        throw new Error(data.error || 'Prediction failed');
      }

      const label = (data.prediction || '').toString();
      predictionText.textContent = label;
      predictionBox.style.display = 'block';
      setStatus('Prediction successful ‚úÖ', 'ok');
    } catch (err) {
      predictionBox.style.display = 'none';
      setStatus(err.message || 'Error while contacting backend.', 'error');
    } finally {
      predictBtn.disabled = false;
      predictBtn.innerHTML = oldHtml;
    }
  });
</script>
</body>
</html>
